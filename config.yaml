# =============================================================================
# Paradex BTC-USD-PERP Market Making Bot - Configuration (Pro Balanced)
# =============================================================================
# Fee breakeven: full_spread > 2 × price × 0.00003 (e.g. $100k → $6.00)
# 平衡策略: 宽spread保护 + 0.5s快刷新 + 积极过滤器
# half_spread = max(min_half_spread, spread × spread_factor + kappa × sigma)

# ============ Platform Settings ============
paradex:
  env: "mainnet"                   # mainnet / testnet
  market: "BTC-USD-PERP"
  profile: "pro"                   # pro (800/s, 0.003% maker fee)

# ============ Core Market Making Parameters ============
strategy:
  # -- Spread公式: half_spread = max(min_half_spread, spread×spread_factor + kappa×sigma)
  # -- 目标: half_spread ≈ $10-16 (full $20-32), 距BBO 3-8tick
  # -- 修复: sigma现在动态(5秒K线RS+EWMA), kappa×sigma真正驱动spread
  # -- 数据: avg逆选$8.3/BTC, $10 half能覆盖正常逆选, 高波动时自动加宽
  gamma: 0.03                      # 归一化仓位后: 0.03×(q/q_max)×σ²
                                   # 50%仓位σ=$12: $2.2偏移(2tick), 100%仓位σ=$20: $12(12tick)
                                   # 学术参考: GLFT 2013, AS 2008 (normalized inventory)
  kappa: 0.60                      # σ>10时贡献: 0.6×13=$7.8(正常), 0.6×20=$12(高波)
                                   # 修复: 0.40太低→kappa×sigma<min_half→spread永远=min
                                   # 0.60让AS模型的动态spread真正生效
                                   # 学术: AS(2008) spread∝kappa×sigma, kappa吸收时间尺度
  spread_factor: 0.30              # 市场spread系数
  min_half_spread: 10.0            # 核心防线! 实测avg_loss=$8.3/BTC逆向移动
                                   # full $20 vs breakeven $5.82 = $14安全边际
                                   # Tiniç&Sensoy(2023): BTC逆选2-5bps, $10≈3bps/side
                                   # 比$7多3tick缓冲, 在BBO后3-4tick处报价
  refresh_interval: 3.0             # 3秒刷新: 减少逆选曝光频率6x
                                   # 0.5s时10.8fills/min→每填单只有0.5s对冲窗口
                                   # 3s时~1.8fills/min→每填单有3s对冲窗口
                                   # 2 API/cycle × 0.33/s = 0.67/s << 800/s Pro limit
  base_size: 0.003                 # $291 notional, maker fee=$0.009/fill
  max_position: 0.01               # $970 notional, ~$49 margin / $500
  vol_window: 60                   # 60s数据窗口 (必须>=max(momentum_window,60))
                                   # 修复: 20s时momentum_window=45s和vol_pause的60s窗口被截断
                                   # 内存: 40tick/s × 60s = 2400条 × 16byte = 38KB
  min_sigma: 15.0                  # BTC 5s σ基线≈$13 (50%年化), $18 (70%年化)
                                   # 10.0太低→低波动期spread偏窄→逆选覆盖不足
                                   # 15.0: kappa×15=$9, 加min_half=$10→half_spread=$10-19
  vol_lambda_up: 0.70               # 非对称EWMA上行: 波动率spike时快速响应
                                   # 0.70在5s K线→3-4根candle(15-20s)内反映spike
                                   # 比0.80更快, 让sigma在大波动初期就上升
  vol_lambda_down: 0.95             # 非对称EWMA下行: spike后缓慢衰减
                                   # 半衰期≈100s (vs 0.80的22s, 慢4.5倍)
                                   # 关键: momentum/vol-pause阻止报价30-60s
                                   # λ=0.80时sigma在此期间衰减完→恢复后spread太窄
                                   # λ=0.95让sigma在filters解除后仍保持较高→宽spread保护
  momentum_window: 45              # 45s动量窗口
  momentum_threshold: 60           # $60触发 (日志: $25/6s=$250/min趋势, 45s≈$30)
                                   # $60能抓住中等强度趋势, 不会太频繁
  vol_pause_threshold: 120         # $120暂停 (日志: 60s范围$80就已经很危险)
                                   # 降低到$120可以在波动初期就暂停
  tick_size: 1.0                   # BTC-USD-PERP tick size ($1)

# ============ OBI (Order Book Imbalance) Overlay ============
obi:
  enabled: true
  alpha: 0.5                       # 快速EMA跟踪orderbook变化
  threshold: 0.40                  # Cont, Kukanov & Stoikov (2014): |OBI|>0.5时R²≈65%
                                   # 0.20过敏 → 频繁误阻, 0.40折中学术标准
  depth: 10                        # 10 levels = 更稳定信号, 减少单大单影响

# ============ Risk Management ============
risk:
  max_loss_per_trade: 3.00         # 0.01 BTC × $300 move
  max_loss_per_hour: 10.00         # 每小时止损
  max_loss_per_day: 25.00          # 每日止损 = 5% of $500
  inventory_timeout: 30            # 30s = 60次报价机会 @ 0.5s刷新
  emergency_timeout: 90            # 90秒强平 (0.5s刷新下=180次报价机会)
  max_unrealized_loss: 4.00        # $4 unrealized loss触发平仓 (更紧, 快止损)
  consecutive_loss_pause: 5        # 5次连亏触发breaker (更敏感, 快暂停)
  consecutive_loss_cooldown: 60    # 60s cooldown (暂停久一点, 等市况变化)
  maker_fee_rate: 0.00003          # Pro: 0.003%
  taker_fee_rate: 0.0002           # Pro: 0.02%

# ============ Rate Limits (Pro Profile) ============
rate_limit:
  max_orders_per_second: 100       # Pro: 800/s
  max_orders_per_minute: 5000      # Pro: 17250/min
  max_orders_per_hour: 50000       # Effectively unlimited
  max_orders_per_day: 500000       # Effectively unlimited

# ============ Trading Schedule (UTC) ============
schedule:
  active_hours_utc: [5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21]
  pause_hours_utc: [22, 23, 0, 1, 2, 3, 4]
                                   # 活跃时间5-21 UTC (覆盖亚洲+欧洲+美国全日)
                                   # 只在深夜低流动性时段暂停 (22-04 UTC)
                                   # 注意: 所有24小时必须在active或pause中, 无遗漏

# ============ Logging ============
logging:
  level: "INFO"                    # DEBUG / INFO / WARNING / ERROR
  trade_csv: "trades.csv"          # Trade log file path
  console_interval: 10             # Status print interval (sec)
